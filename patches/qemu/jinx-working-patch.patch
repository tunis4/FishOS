diff --color -urN --no-dereference qemu-clean/backends/tpm/tpm_ioctl.h qemu-workdir/backends/tpm/tpm_ioctl.h
--- qemu-clean/backends/tpm/tpm_ioctl.h	2025-08-26 21:32:37.000000000 +0300
+++ qemu-workdir/backends/tpm/tpm_ioctl.h	2025-08-26 21:32:37.000000000 +0300
@@ -285,30 +285,6 @@
 #define PTM_CAP_SEND_COMMAND_HEADER (1 << 15)
 #define PTM_CAP_LOCK_STORAGE       (1 << 16)
 
-#ifndef _WIN32
-enum {
-    PTM_GET_CAPABILITY     = _IOR('P', 0, ptm_cap),
-    PTM_INIT               = _IOWR('P', 1, ptm_init),
-    PTM_SHUTDOWN           = _IOR('P', 2, ptm_res),
-    PTM_GET_TPMESTABLISHED = _IOR('P', 3, ptm_est),
-    PTM_SET_LOCALITY       = _IOWR('P', 4, ptm_loc),
-    PTM_HASH_START         = _IOR('P', 5, ptm_res),
-    PTM_HASH_DATA          = _IOWR('P', 6, ptm_hdata),
-    PTM_HASH_END           = _IOR('P', 7, ptm_res),
-    PTM_CANCEL_TPM_CMD     = _IOR('P', 8, ptm_res),
-    PTM_STORE_VOLATILE     = _IOR('P', 9, ptm_res),
-    PTM_RESET_TPMESTABLISHED = _IOWR('P', 10, ptm_reset_est),
-    PTM_GET_STATEBLOB      = _IOWR('P', 11, ptm_getstate),
-    PTM_SET_STATEBLOB      = _IOWR('P', 12, ptm_setstate),
-    PTM_STOP               = _IOR('P', 13, ptm_res),
-    PTM_GET_CONFIG         = _IOR('P', 14, ptm_getconfig),
-    PTM_SET_DATAFD         = _IOR('P', 15, ptm_res),
-    PTM_SET_BUFFERSIZE     = _IOWR('P', 16, ptm_setbuffersize),
-    PTM_GET_INFO           = _IOWR('P', 17, ptm_getinfo),
-    PTM_LOCK_STORAGE       = _IOWR('P', 18, ptm_lockstorage),
-};
-#endif
-
 /*
  * Commands used by the non-CUSE TPMs
  *
diff --color -urN --no-dereference qemu-clean/block/file-posix.c qemu-workdir/block/file-posix.c
--- qemu-clean/block/file-posix.c	2025-08-26 21:32:37.000000000 +0300
+++ qemu-workdir/block/file-posix.c	2025-08-26 21:32:37.000000000 +0300
@@ -125,6 +125,8 @@
 #endif
 #endif
 
+#include <sys/ioctl.h>
+
 /* Approximate O_DIRECT with O_DSYNC if O_DIRECT isn't available */
 #ifndef O_DIRECT
 #define O_DIRECT O_DSYNC
diff --color -urN --no-dereference qemu-clean/configure qemu-workdir/configure
--- qemu-clean/configure	2025-08-26 21:32:37.000000000 +0300
+++ qemu-workdir/configure	2025-08-26 21:32:37.000000000 +0300
@@ -343,7 +343,9 @@
 EOF
 }
 
-if check_define __linux__ ; then
+if check_define __fishos__ ; then
+  host_os=fishos
+elif check_define __linux__ ; then
   host_os=linux
 elif check_define _WIN32 ; then
   host_os=windows
diff --color -urN --no-dereference qemu-clean/include/gdbstub/syscalls.h qemu-workdir/include/gdbstub/syscalls.h
--- qemu-clean/include/gdbstub/syscalls.h	2025-08-26 21:32:38.000000000 +0300
+++ qemu-workdir/include/gdbstub/syscalls.h	2025-08-26 21:32:38.000000000 +0300
@@ -41,9 +41,10 @@
 #define GDB_EUNKNOWN       9999
 
 /* For gdb file i/o remote protocol lseek whence. */
-#define GDB_SEEK_SET  0
-#define GDB_SEEK_CUR  1
-#define GDB_SEEK_END  2
+#include <unistd.h>
+#define GDB_SEEK_SET  SEEK_SET
+#define GDB_SEEK_CUR  SEEK_CUR
+#define GDB_SEEK_END  SEEK_END
 
 /* For gdb file i/o stat/fstat. */
 typedef uint32_t gdb_mode_t;
diff --color -urN --no-dereference qemu-clean/meson.build qemu-workdir/meson.build
--- qemu-clean/meson.build	2025-08-26 21:32:38.000000000 +0300
+++ qemu-workdir/meson.build	2025-09-13 13:10:15.518649526 +0300
@@ -903,7 +903,7 @@
 endif
 
 nvmm = not_found
-if host_os == 'netbsd'
+if host_os == 'netbsd' 
   nvmm = cc.find_library('nvmm', required: get_option('nvmm'))
   if nvmm.found()
     accelerators += 'CONFIG_NVMM'
@@ -2561,6 +2561,7 @@
 config_host_data.set('CONFIG_SLIRP', slirp.found())
 config_host_data.set('CONFIG_SNAPPY', snappy.found())
 config_host_data.set('CONFIG_SOLARIS', host_os == 'sunos')
+config_host_data.set('CONFIG_FISHOS', host_os == 'fishos')
 if have_tcg
   config_host_data.set('CONFIG_TCG', 1)
   config_host_data.set('CONFIG_TCG_INTERPRETER', tcg_arch == 'tci')
@@ -2753,9 +2754,9 @@
 
 # has_header_symbol
 config_host_data.set('CONFIG_BLKZONED',
-                     cc.has_header_symbol('linux/blkzoned.h', 'BLKOPENZONE'))
+                     false) # cc.has_header_symbol('linux/blkzoned.h', 'BLKOPENZONE'))
 config_host_data.set('CONFIG_EPOLL_CREATE1',
-                     cc.has_header_symbol('sys/epoll.h', 'epoll_create1'))
+                     false) # cc.has_header_symbol('sys/epoll.h', 'epoll_create1'))
 config_host_data.set('CONFIG_FALLOCATE_PUNCH_HOLE',
                      cc.has_header_symbol('linux/falloc.h', 'FALLOC_FL_PUNCH_HOLE') and
                      cc.has_header_symbol('linux/falloc.h', 'FALLOC_FL_KEEP_SIZE'))
diff --color -urN --no-dereference qemu-clean/subprojects/dtc/libfdt/meson.build qemu-workdir/subprojects/dtc/libfdt/meson.build
--- qemu-clean/subprojects/dtc/libfdt/meson.build	2025-09-13 12:55:28.027622789 +0300
+++ qemu-workdir/subprojects/dtc/libfdt/meson.build	2025-09-13 12:55:28.027622789 +0300
@@ -21,7 +21,7 @@
   version: '1.6.0',
   link_args: ['-Wl,--no-undefined', version_script],
   link_depends: 'version.lds',
-  install: true,
+  install: false,
 )
 
 libfdt_inc = include_directories('.')
@@ -30,21 +30,3 @@
   include_directories: libfdt_inc,
   link_with: libfdt,
 )
-
-install_headers(
-  files(
-    'fdt.h',
-    'libfdt.h',
-    'libfdt_env.h',
-  )
-)
-
-pkgconfig = import('pkgconfig')
-
-pkgconfig.generate(
-  libraries: libfdt,
-  version: meson.project_version(),
-  filebase: 'libfdt',
-  name: 'libfdt',
-  description: 'Flat Device Tree manipulation',
-)
